<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Health Tracker</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
  
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    font-family: 'Inter', sans-serif;
    background: #08080d;
    color: #e0e0e0;
    min-height: 100vh;
    padding: 0;
    overflow-x: hidden;
  }

  .header {
    padding: 20px 20px 16px;
    position: sticky;
    top: 0;
    background: #08080d;
    z-index: 100;
    border-bottom: 1px solid #151520;
  }

  .header h1 { font-size: 20px; font-weight: 300; color: #fff; letter-spacing: -0.5px; }
  .header-sub { font-size: 12px; color: #555; margin-top: 2px; }
  .header-sub span { color: #4ade80; font-weight: 500; }

  .streak-banner {
    display: flex;
    gap: 8px;
    padding: 14px 16px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .streak-pill {
    flex-shrink: 0;
    background: #0e0e16;
    border: 1px solid #1a1a28;
    border-radius: 12px;
    padding: 10px 14px;
    text-align: center;
    min-width: 80px;
  }

  .streak-pill-num { font-size: 22px; font-weight: 700; line-height: 1; }
  .streak-pill-num.green { color: #4ade80; }
  .streak-pill-num.blue { color: #60a5fa; }
  .streak-pill-num.amber { color: #f59e0b; }
  .streak-pill-num.purple { color: #c084fc; }
  .streak-pill-label { font-size: 9px; color: #555; text-transform: uppercase; letter-spacing: 0.8px; margin-top: 3px; }

  .week-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
    border-bottom: 1px solid #151520;
  }

  .week-nav button {
    background: #141420;
    border: 1px solid #222240;
    color: #999;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
  }

  .week-label { font-size: 13px; font-weight: 500; color: #ccc; }

  .tracker-section { padding: 12px 16px 100px; }

  .summary-card {
    background: linear-gradient(135deg, #0e1a0e 0%, #0e0e16 100%);
    border: 1px solid #1a2e1a;
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 12px;
  }

  .summary-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px; color: #4ade80; margin-bottom: 12px; }

  .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
  .summary-stat { text-align: center; padding: 8px 4px; background: #0a120a; border-radius: 8px; }
  .summary-val { font-size: 18px; font-weight: 600; color: #fff; }
  .summary-label { font-size: 9px; color: #555; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }

  .day-card {
    background: #0e0e16;
    border: 1px solid #1a1a28;
    border-radius: 14px;
    margin-bottom: 8px;
    overflow: hidden;
  }

  .day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 16px;
    cursor: pointer;
  }

  .day-name { font-size: 14px; font-weight: 500; color: #ccc; }
  .day-name.today { color: #4ade80; }
  .day-summary { font-size: 11px; color: #555; }

  .day-score { display: flex; gap: 4px; }
  .score-dot { width: 8px; height: 8px; border-radius: 50%; background: #1e1e35; }
  .score-dot.filled { background: #4ade80; }
  .score-dot.partial { background: #f59e0b; }
  .score-dot.bad { background: #ef4444; }

  .day-fields { padding: 0 16px 16px; display: none; }
  .day-fields.open { display: block; }

  .field-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #12121e;
  }
  .field-row:last-child { border-bottom: none; }

  .field-label { font-size: 13px; color: #999; flex: 1; }

  .field-input {
    background: #141420;
    border: 1px solid #222240;
    border-radius: 8px;
    color: #fff;
    font-family: 'Inter', sans-serif;
    font-size: 14px;
    padding: 8px 12px;
    width: 80px;
    text-align: center;
    outline: none;
  }
  .field-input:focus { border-color: #4ade80; }

  .field-toggle {
    width: 44px;
    height: 26px;
    border-radius: 13px;
    background: #1e1e35;
    border: none;
    position: relative;
    cursor: pointer;
    transition: background 0.2s;
  }
  .field-toggle::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #555;
    transition: all 0.2s;
  }
  .field-toggle.on { background: #1a3a2a; }
  .field-toggle.on::after { left: 21px; background: #4ade80; }

  .goals-input {
    background: #141420;
    border: 1px solid #222240;
    border-radius: 8px;
    color: #fff;
    font-family: 'Inter', sans-serif;
    font-size: 13px;
    padding: 10px 12px;
    width: 100%;
    outline: none;
    resize: none;
    min-height: 50px;
  }
  .goals-input:focus { border-color: #4ade80; }

  .milestone-section { padding: 0 16px; margin-top: 4px; margin-bottom: 16px; }
  .milestone-section-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.5px; color: #444; margin-bottom: 10px; padding-left: 4px; }

  .milestone-row {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    background: #0e0e16;
    border: 1px solid #1a1a28;
    border-radius: 10px;
    margin-bottom: 6px;
  }

  .milestone-badge {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
  }
  .milestone-badge.locked { background: #1a1a2e; color: #444; }
  .milestone-badge.unlocked { background: #1a3a2a; color: #4ade80; }

  .milestone-text { flex: 1; }
  .milestone-name { font-size: 12px; color: #ccc; font-weight: 500; }
  .milestone-sub { font-size: 10px; color: #444; margin-top: 1px; }
  .milestone-bar { width: 100%; height: 2px; background: #1e1e35; border-radius: 1px; margin-top: 5px; overflow: hidden; }
  .milestone-fill { height: 100%; background: linear-gradient(90deg, #4ade80, #22d3ee); border-radius: 1px; }

  .quote-footer {
    text-align: center;
    padding: 28px 24px 40px;
    border-top: 1px solid #151520;
    margin: 0 16px;
  }
  .quote-footer p { font-size: 13px; font-style: italic; color: #444; line-height: 1.6; }
  .quote-footer .attr { font-size: 11px; color: #333; margin-top: 6px; font-style: normal; }

  .save-toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(60px);
    background: #1a3a2a;
    border: 1px solid #2d5a3d;
    color: #4ade80;
    padding: 8px 18px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 500;
    transition: transform 0.3s ease;
    z-index: 200;
  }
  .save-toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<div class="header">
  <h1>Health Tracker</h1>
  <div class="header-sub">Started <span>February 27, 2026</span></div>
</div>

<div class="streak-banner">
  <div class="streak-pill"><div class="streak-pill-num green" id="soberStreak">0</div><div class="streak-pill-label">Sober</div></div>
  <div class="streak-pill"><div class="streak-pill-num blue" id="nicStreak">0</div><div class="streak-pill-label">Nic Free</div></div>
  <div class="streak-pill"><div class="streak-pill-num amber" id="exStreak">0</div><div class="streak-pill-label">Workouts</div></div>
  <div class="streak-pill"><div class="streak-pill-num purple" id="bibleStreak">0</div><div class="streak-pill-label">Bible</div></div>
</div>

<div class="week-nav">
  <button id="prevWeek">&larr;</button>
  <span class="week-label" id="weekLabel"></span>
  <button id="nextWeek">&rarr;</button>
</div>

<div class="tracker-section" id="trackerSection"></div>

<div class="milestone-section">
  <div class="milestone-section-title">Milestones</div>
  <div id="milestoneSection"></div>
</div>

<div class="quote-footer">
  <p>"Realize how lucky you got and live forward like you got off so lucky."</p>
  <div class="attr">-- Z.M.</div>
</div>

<div class="save-toast" id="saveToast">Saved</div>

<script>
const FIELDS = [
  { key: 'drinks', label: 'Drinks', type: 'number', placeholder: '0' },
  { key: 'nicotine', label: 'Nicotine (mg)', type: 'number', placeholder: '0' },
  { key: 'thc', label: 'THC', type: 'toggle' },
  { key: 'bible', label: 'Bible', type: 'toggle' },
  { key: 'sleep', label: 'Sleep (hrs)', type: 'number', placeholder: '0', step: '0.5' },
  { key: 'caffeine', label: 'Caffeine (mg)', type: 'number', placeholder: '0' },
  { key: 'eatWell', label: 'Eat Well', type: 'toggle' },
  { key: 'weight', label: 'Weight (AM)', type: 'number', placeholder: '--', step: '0.1' },
  { key: 'exercise', label: 'Exercise', type: 'toggle' },
  { key: 'goals', label: 'Goals / Notes', type: 'text', placeholder: 'Notes for the day...' },
];

const MILESTONES = [
  { days: 1, name: 'Day 1 -- The Decision', desc: 'You showed up.' },
  { days: 7, name: 'One Week', desc: 'Your body starts to reset.' },
  { days: 30, name: 'One Month', desc: 'New habits forming.' },
  { days: 60, name: 'Two Months', desc: 'This is who you are now.' },
  { days: 90, name: '90 Days', desc: 'Real transformation.' },
  { days: 100, name: 'Proposal Day Clean', desc: 'Walk in at your best.' },
];

let currentWeekStart = getWeekStart(new Date());
let data = JSON.parse(localStorage.getItem('healthData') || '{}');

function getWeekStart(date) {
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(d.getFullYear(), d.getMonth(), diff);
}

function fmt(d) { return d.toISOString().split('T')[0]; }

function fmtShort(d) {
  const m = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return m[d.getMonth()] + ' ' + d.getDate();
}

function dayName(d) { return ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][d.getDay()]; }

function isToday(d) { return d.toDateString() === new Date().toDateString(); }

function save() {
  localStorage.setItem('healthData', JSON.stringify(data));
  const t = document.getElementById('saveToast');
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 1200);
  updateStreaks();
}

function setVal(dk, key, val) {
  if (!data[dk]) data[dk] = {};
  data[dk][key] = val;
  save();
}

function renderWeek() {
  const sec = document.getElementById('trackerSection');
  sec.innerHTML = '';

  const we = new Date(currentWeekStart);
  we.setDate(we.getDate() + 6);
  document.getElementById('weekLabel').textContent = fmtShort(currentWeekStart) + ' - ' + fmtShort(we);

  // Weekly summary
  let tDrinks=0, tNic=0, tSleep=0, sDays=0, tWork=0, tBible=0, tCaff=0;
  for (let i=0;i<7;i++) {
    const d = new Date(currentWeekStart); d.setDate(d.getDate()+i);
    const dd = data[fmt(d)] || {};
    tDrinks += Number(dd.drinks||0);
    tNic += Number(dd.nicotine||0);
    tCaff += Number(dd.caffeine||0);
    if (dd.sleep) { tSleep += Number(dd.sleep); sDays++; }
    if (dd.exercise) tWork++;
    if (dd.bible) tBible++;
  }

  sec.innerHTML += `
    <div class="summary-card">
      <div class="summary-title">Week Summary</div>
      <div class="summary-grid">
        <div class="summary-stat"><div class="summary-val">${tDrinks}</div><div class="summary-label">Drinks</div></div>
        <div class="summary-stat"><div class="summary-val">${tNic}</div><div class="summary-label">Nic (mg)</div></div>
        <div class="summary-stat"><div class="summary-val">${sDays?(tSleep/sDays).toFixed(1):'--'}</div><div class="summary-label">Avg Sleep</div></div>
        <div class="summary-stat"><div class="summary-val">${tWork}</div><div class="summary-label">Workouts</div></div>
      </div>
    </div>`;

  // Day cards
  for (let i=0;i<7;i++) {
    const d = new Date(currentWeekStart); d.setDate(d.getDate()+i);
    const dk = fmt(d);
    const today = isToday(d);
    const dd = data[dk] || {};
    const has = Object.keys(dd).length > 0;

    let dots = '';
    if (has) {
      dots += `<div class="score-dot ${(!dd.drinks||dd.drinks==0)?'filled':'bad'}"></div>`;
      dots += `<div class="score-dot ${(!dd.nicotine||dd.nicotine==0)?'filled':'partial'}"></div>`;
      dots += `<div class="score-dot ${dd.exercise?'filled':''}"></div>`;
      dots += `<div class="score-dot ${dd.bible?'filled':''}"></div>`;
    }

    let fields = '';
    FIELDS.forEach(f => {
      if (f.type==='toggle') {
        fields += `<div class="field-row"><div class="field-label">${f.label}</div><button class="field-toggle ${dd[f.key]?'on':''}" onclick="toggleF('${dk}','${f.key}',this)"></button></div>`;
      } else if (f.type==='text') {
        fields += `<div class="field-row" style="flex-direction:column;align-items:stretch;gap:6px;"><div class="field-label">${f.label}</div><textarea class="goals-input" placeholder="${f.placeholder}" onchange="setVal('${dk}','${f.key}',this.value)">${dd[f.key]||''}</textarea></div>`;
      } else {
        fields += `<div class="field-row"><div class="field-label">${f.label}</div><input class="field-input" type="number" inputmode="decimal" placeholder="${f.placeholder}" ${f.step?'step="'+f.step+'"':''} value="${dd[f.key]||''}" onchange="setVal('${dk}','${f.key}',this.value)"></div>`;
      }
    });

    sec.innerHTML += `
      <div class="day-card">
        <div class="day-header" onclick="document.getElementById('df-${i}').classList.toggle('open')">
          <div><div class="day-name ${today?'today':''}">${dayName(d)}${today?' (Today)':''}</div><div class="day-summary">${fmtShort(d)}</div></div>
          <div class="day-score">${dots}</div>
        </div>
        <div class="day-fields ${today?'open':''}" id="df-${i}">${fields}</div>
      </div>`;
  }
}

function toggleF(dk,key,btn) {
  if (!data[dk]) data[dk]={};
  data[dk][key] = !data[dk][key];
  save();
  btn.classList.toggle('on');
  // Re-render summary
  renderWeek();
}

function updateStreaks() {
  let sober=0, nic=0, bible=0;
  let d = new Date();
  
  // Sober streak
  let dd = new Date(d);
  while(true) {
    const dk=fmt(dd), day=data[dk]||{};
    if (Number(day.drinks||0)>0 || day.thc) break;
    if (!Object.keys(day).length && sober>0) break;
    if (Object.keys(day).length) sober++;
    dd.setDate(dd.getDate()-1);
    if(sober>999) break;
  }
  
  // Nic streak
  dd = new Date(d);
  while(true) {
    const dk=fmt(dd), day=data[dk]||{};
    if (Number(day.nicotine||0)>0) break;
    if (!Object.keys(day).length && nic>0) break;
    if (Object.keys(day).length) nic++;
    dd.setDate(dd.getDate()-1);
    if(nic>999) break;
  }
  
  // Bible streak
  dd = new Date(d);
  while(true) {
    const dk=fmt(dd), day=data[dk]||{};
    if (!day.bible) break;
    bible++;
    dd.setDate(dd.getDate()-1);
    if(bible>999) break;
  }

  // Workouts this week
  let work=0;
  const ws = getWeekStart(new Date());
  for(let i=0;i<7;i++) {
    const wd=new Date(ws); wd.setDate(wd.getDate()+i);
    if(data[fmt(wd)]?.exercise) work++;
  }

  document.getElementById('soberStreak').textContent = sober;
  document.getElementById('nicStreak').textContent = nic;
  document.getElementById('exStreak').textContent = work;
  document.getElementById('bibleStreak').textContent = bible;

  // Milestones
  const ms = document.getElementById('milestoneSection');
  ms.innerHTML = '';
  const best = Math.max(sober, nic);
  MILESTONES.forEach(m => {
    const un = best >= m.days;
    const pct = Math.min(100, (best/m.days)*100);
    ms.innerHTML += `<div class="milestone-row"><div class="milestone-badge ${un?'unlocked':'locked'}">${un?'&#10003;':m.days}</div><div class="milestone-text"><div class="milestone-name">${m.name}</div><div class="milestone-sub">${m.desc}</div><div class="milestone-bar"><div class="milestone-fill" style="width:${pct}%"></div></div></div></div>`;
  });
}

document.getElementById('prevWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate()-7); renderWeek(); };
document.getElementById('nextWeek').onclick = () => { currentWeekStart.setDate(currentWeekStart.getDate()+7); renderWeek(); };

renderWeek();
updateStreaks();
</script>
</body>
</html>
